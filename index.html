<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹å·å¤§å†’éšª 8æ—¥éŠ (è¡Œç¨‹æ›´æ–°ç‰ˆ)</title>
    
    <!-- Google Fonts: Mochiy Pop One (å¯æ„›æ—¥ç³»é¢¨) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config for Shin-chan Style -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'shin-yellow': '#FFEC3D', // å°æ–°è¡£æœé»ƒ
                        'shin-red': '#FF4D4F',    // å°æ–°è¤²å­ç´…
                        'shin-blue': '#40A9FF',   // å¹¼ç¨šåœ’åˆ¶æœè—
                        'shin-green': '#95DE64',
                        'shin-bg': '#FFFBE6',
                    },
                    fontFamily: {
                        'cute': ['"Mochiy Pop One"', 'sans-serif'],
                        'body': ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    boxShadow: {
                        'cartoon': '4px 4px 0px 0px #000000',
                        'cartoon-sm': '2px 2px 0px 0px #000000',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #FFFBE6;
            background-image: radial-gradient(#FFEC3D 15%, transparent 16%), radial-gradient(#40A9FF 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            font-family: 'Zen Maru Gothic', sans-serif;
            padding-bottom: 80px; /* Space for bottom nav */
            overscroll-behavior-y: none;
        }
        
        h1, h2, h3, .font-cute {
            font-family: 'Mochiy Pop One', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #FF4D4F; 
            border-radius: 10px;
        }

        /* Cartoon Border Utility */
        .cartoon-box {
            border: 3px solid black;
            border-radius: 16px;
            box-shadow: 4px 4px 0px 0px #000000;
            background: white;
            transition: all 0.1s;
        }
        
        .cartoon-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px 0px #000000;
        }

        .section-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .section-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #000;
            z-index: 0;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="fixed top-0 left-0 w-full z-50 bg-shin-yellow border-b-4 border-black px-4 py-3 flex justify-between items-center shadow-cartoon">
        <h1 class="text-xl font-cute text-black"><i class="fa-solid fa-plane-departure mr-2"></i>ä¹å·å¤§å†’éšª</h1>
        <div class="text-xs font-bold bg-white border-2 border-black px-2 py-1 rounded-lg shadow-cartoon-sm">
            12/2 - 12/9
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="container mx-auto px-4 pt-20 max-w-md">

        <!-- SECTION: PLAN (è¡Œç¨‹) -->
        <section id="plan" class="section-content active">
            
            <!-- Flight Card -->
            <div class="cartoon-box bg-shin-blue p-4 mb-6 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-white opacity-20 text-8xl"><i class="fa-solid fa-plane"></i></div>
                <h2 class="text-lg font-cute mb-2 border-b-2 border-black pb-1 inline-block bg-white px-2 rounded">èˆªç­è³‡è¨Š (é•·æ¦®)</h2>
                <div class="bg-white border-2 border-black rounded-lg p-3 mb-2 shadow-cartoon-sm">
                    <div class="font-bold text-shin-red">å»ç¨‹ BR104 (12/2)</div>
                    <div class="flex justify-between items-center">
                        <span>11:40 TPE</span> <i class="fa-solid fa-arrow-right"></i> <span>14:55 FUK</span>
                    </div>
                </div>
                <div class="bg-white border-2 border-black rounded-lg p-3 shadow-cartoon-sm">
                    <div class="font-bold text-shin-red">å›ç¨‹ BR105 (12/9)</div>
                    <div class="flex justify-between items-center">
                        <span>12:15 FUK</span> <i class="fa-solid fa-arrow-right"></i> <span>13:50 TPE</span>
                    </div>
                </div>
            </div>

            <!-- Accommodation -->
            <div class="cartoon-box bg-shin-green p-4 mb-6">
                <h2 class="text-lg font-cute mb-2 bg-white border-2 border-black px-2 rounded inline-block">ä½å®¿è³‡è¨Š</h2>
                <div class="space-y-3">
                    <div class="bg-white p-3 rounded border-2 border-black shadow-cartoon-sm">
                        <div class="font-bold text-sm text-gray-500">åšå¤š (å‰æ®µ)</div>
                        <div class="font-bold">Daiwa Roynet Hotel Hakata-Reisen</div>
                        <a href="https://www.google.com/maps/search/?api=1&query=Daiwa+Roynet+Hotel+Hakata-Reisen" target="_blank" class="text-blue-500 text-sm underline"><i class="fa-solid fa-map-location-dot"></i> é–‹å•Ÿåœ°åœ–</a>
                    </div>
                    <div class="bg-white p-3 rounded border-2 border-black shadow-cartoon-sm">
                        <div class="font-bold text-sm text-gray-500">æµ®ç¾½/ä¹…ç•™ç±³ (ä¸­å¾Œæ®µ)</div>
                        <div class="font-bold">Ukiha-shi, Fukuoka</div>
                        <div class="text-xs text-gray-600">734-6 Ukihamachi Yamakita</div>
                        <a href="https://www.google.com/maps/search/?api=1&query=734-6+Ukihamachi+Yamakita,+Ukiha-shi" target="_blank" class="text-blue-500 text-sm underline"><i class="fa-solid fa-map-location-dot"></i> é–‹å•Ÿåœ°åœ–</a>
                    </div>
                </div>
            </div>

            <!-- Daily Itinerary Container -->
            <div id="itinerary-list" class="space-y-6 pb-20">
                <!-- Javascript will populate this -->
            </div>
        </section>

        <!-- SECTION: GUIDE (å°è¦½) -->
        <section id="guide" class="section-content">
            <h2 class="text-2xl font-cute text-center mb-6 bg-white border-2 border-black p-2 rounded-lg shadow-cartoon inline-block mx-auto transform -rotate-2">æ™¯é»æ·±åº¦éŠ</h2>

            <!-- Kumamon Square -->
            <article class="cartoon-box mb-6 overflow-hidden">
                <img src="https://kumamon-sq.jp/en/common/img/ogp.png" alt="Kumamon" class="w-full h-40 object-cover border-b-2 border-black">
                <div class="p-4">
                    <h3 class="text-xl font-cute mb-2 text-shin-red">ç†Šæœ¬ç†Šéƒ¨é•·è¾¦å…¬å®¤</h3>
                    <p class="text-sm leading-relaxed mb-3 text-gray-700">
                        é€™ä¸åªæ˜¯ä¸€å€‹å‰ç¥¥ç‰©çš„è¦‹é¢æœƒï¼Œé€™æ˜¯ç†Šæœ¬ç¸£çš„ç‡Ÿæ¥­éƒ¨é•·è¾¦å…¬å®¤ï¼
                        <br><br>
                        <span class="font-bold bg-yellow-200 px-1">å†·çŸ¥è­˜ï¼š</span>ç†Šæœ¬ç†Š (Kumamon) å…¶å¯¦ä¸æ˜¯ç†Šï¼Œè€Œæ˜¯ç†Šæœ¬ç¸£çš„å…¬å‹™å“¡ã€‚ä»–åœ¨ 2011 å¹´ä¹å·æ–°å¹¹ç·šå…¨ç·šé€šè»Šæ™‚èª•ç”Ÿã€‚é›–ç„¶çœ‹èµ·ä¾†ç¬¨ç¬¨çš„ï¼Œä½†ä»–å¸¶ä¾†çš„ç¶“æ¿Ÿæ•ˆç›Šå·²è¶…é 1000 å„„æ—¥åœ“ï¼
                    </p>
                    <div class="bg-gray-100 p-2 rounded border border-gray-300 text-xs">
                        <i class="fa-solid fa-triangle-exclamation text-red-500"></i> 
                        é€šå¸¸è¡¨æ¼” 16:30 é–‹å§‹ (è«‹ç•¶æ—¥å†ç¢ºèªä¸€æ¬¡é€±ä¸€æ™‚åˆ»è¡¨)ï¼Œå»ºè­°æå‰ 1 å°æ™‚åˆ°é¶´å±‹ç™¾è²¨ 1F å»£å ´æ’éšŠã€‚
                    </div>
                </div>
            </article>

            <!-- Yufuin -->
            <article class="cartoon-box mb-6 overflow-hidden">
                <div class="bg-green-100 h-40 flex items-center justify-center border-b-2 border-black">
                    <i class="fa-solid fa-spa text-6xl text-green-600"></i>
                </div>
                <div class="p-4">
                    <h3 class="text-xl font-cute mb-2 text-green-600">ç”±å¸ƒé™¢ (æ¹¯å¸ƒé™¢)</h3>
                    <p class="text-sm leading-relaxed mb-3 text-gray-700">
                        æ—¥æœ¬ OL ç¥¨é¸æœ€æƒ³å»çš„æº«æ³‰å‹åœ°ç¬¬ä¸€åã€‚é€™è£¡æ²’æœ‰å¤§å‹æº«æ³‰é£¯åº—çš„å£“è¿«æ„Ÿï¼Œåªæœ‰ç²¾ç·»çš„å°åº—èˆ‡ç”°åœ’é¢¨å…‰ã€‚
                        <br><br>
                        <span class="font-bold bg-blue-200 px-1">å¿…çœ‹ï¼š</span>é‡‘é±—æ¹–åœ¨ç§‹å†¬çš„æ¸…æ™¨ï¼Œæ¹–é¢æœƒå› ç‚ºæº«æ³‰æ°´èˆ‡å†·ç©ºæ°£äº¤æœƒè€Œç”¢ç”Ÿå¤¢å¹»çš„ã€Œæœéœ§ã€ï¼Œåƒä»™å¢ƒä¸€æ¨£ã€‚
                    </p>
                </div>
            </article>

            <!-- Map Embed (Kumamon Square as example) -->
            <div class="cartoon-box p-2 mb-4">
                <div class="text-center font-bold mb-2">ç†Šæœ¬å¸‚å€åœ°åœ–</div>
                <iframe width="100%" height="250" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=130.7000%2C32.7950%2C130.7200%2C32.8100&amp;layer=mapnik&amp;marker=32.8028%2C130.7079" style="border: 2px solid black; border-radius: 8px;"></iframe>
                <small><a href="https://www.openstreetmap.org/?mlat=32.8028&amp;mlon=130.7079#map=16/32.8028/130.7079" class="text-blue-500 underline">æŸ¥çœ‹å¤§åœ–</a></small>
            </div>
        </section>

        <!-- SECTION: WALLET (è¨˜å¸³) -->
        <section id="wallet" class="section-content">
            
            <!-- Calculator -->
            <div class="cartoon-box bg-gray-800 text-white p-4 mb-6">
                <div class="flex justify-between items-end mb-2">
                    <label class="text-xs text-gray-400">åŒ¯ç‡è¨ˆç®—æ©Ÿ (x0.2)</label>
                    <div class="text-xs text-gray-400">æ”¯æ´ + - * /</div>
                </div>
                <input type="text" id="calc-input" placeholder="è¼¸å…¥æ—¥å¹£ç®—å¼..." class="w-full bg-black text-right text-2xl font-mono p-2 rounded border border-gray-600 mb-2 text-yellow-400 focus:outline-none focus:border-yellow-400">
                <div class="flex justify-between items-center bg-gray-700 p-2 rounded">
                    <div class="text-gray-300 text-sm">ç´„å°å¹£</div>
                    <div class="text-3xl font-bold text-white" id="calc-result-twd">NT$ 0</div>
                </div>
                <div class="grid grid-cols-4 gap-2 mt-3">
                    <button onclick="addToCalc('7')" class="bg-gray-600 p-2 rounded">7</button>
                    <button onclick="addToCalc('8')" class="bg-gray-600 p-2 rounded">8</button>
                    <button onclick="addToCalc('9')" class="bg-gray-600 p-2 rounded">9</button>
                    <button onclick="addToCalc('/')" class="bg-orange-500 p-2 rounded text-black font-bold">Ã·</button>
                    
                    <button onclick="addToCalc('4')" class="bg-gray-600 p-2 rounded">4</button>
                    <button onclick="addToCalc('5')" class="bg-gray-600 p-2 rounded">5</button>
                    <button onclick="addToCalc('6')" class="bg-gray-600 p-2 rounded">6</button>
                    <button onclick="addToCalc('*')" class="bg-orange-500 p-2 rounded text-black font-bold">Ã—</button>
                    
                    <button onclick="addToCalc('1')" class="bg-gray-600 p-2 rounded">1</button>
                    <button onclick="addToCalc('2')" class="bg-gray-600 p-2 rounded">2</button>
                    <button onclick="addToCalc('3')" class="bg-gray-600 p-2 rounded">3</button>
                    <button onclick="addToCalc('-')" class="bg-orange-500 p-2 rounded text-black font-bold">-</button>
                    
                    <button onclick="clearCalc()" class="bg-red-500 p-2 rounded text-white font-bold">C</button>
                    <button onclick="addToCalc('0')" class="bg-gray-600 p-2 rounded">0</button>
                    <button onclick="calculate()" class="col-span-1 bg-green-500 p-2 rounded text-black font-bold">=</button>
                    <button onclick="addToCalc('+')" class="bg-orange-500 p-2 rounded text-black font-bold">+</button>
                </div>
            </div>

            <!-- Expense Tracker Form -->
            <div class="cartoon-box p-4 mb-6 bg-pink-50">
                <h3 class="font-cute mb-3 text-lg"><i class="fa-solid fa-receipt mr-2"></i>æ–°å¢è¨˜å¸³</h3>
                <div class="space-y-3">
                    <input type="text" id="expense-item" placeholder="å“é …åç¨±" class="w-full border-2 border-black rounded p-2 focus:outline-none focus:shadow-cartoon-sm transition">
                    <input type="number" id="expense-amount" placeholder="æ—¥å¹£é‡‘é¡" class="w-full border-2 border-black rounded p-2 focus:outline-none focus:shadow-cartoon-sm transition">
                    
                    <div class="flex items-center space-x-2">
                        <label class="flex-1 bg-white border-2 border-black py-2 px-4 rounded cursor-pointer hover:bg-gray-100 text-center">
                            <i class="fa-solid fa-camera mr-2"></i>æ‹ç…§/ä¸Šå‚³
                            <input type="file" id="expense-img" accept="image/*" class="hidden" onchange="previewImage()">
                        </label>
                        <button onclick="addExpense()" class="flex-1 bg-shin-yellow border-2 border-black py-2 px-4 rounded font-bold hover:bg-yellow-400 cartoon-btn">
                            å„²å­˜
                        </button>
                    </div>
                    <!-- Image Preview -->
                    <div id="img-preview-container" class="hidden">
                        <img id="img-preview" class="w-20 h-20 object-cover border-2 border-black rounded bg-white">
                        <span class="text-xs text-gray-500">å·²é¸æ“‡åœ–ç‰‡</span>
                    </div>
                </div>
            </div>
            <div class="mb-4">
                <!-- Expense List -->
                <div class="mb-2 flex justify-between items-center">  
                    <h3 class="font-cute text-xl">æ¶ˆè²»ç´€éŒ„</h3>
                    <button onclick="clearExpenses()" class="text-xs text-red-500 underline">æ¸…ç©ºç´€éŒ„</button>
                </div>
                <!-- NEW EXPORT BUTTONS -->
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="exportCSV()" class="bg-green-500 text-white border-2 border-black rounded p-2 font-bold shadow-cartoon-sm cartoon-btn text-xs flex justify-center items-center">
                        <i class="fa-solid fa-file-csv mr-1"></i> åŒ¯å‡º Excel
                    </button>
                    <button onclick="copyToClipboard()" class="bg-gray-700 text-white border-2 border-black rounded p-2 font-bold shadow-cartoon-sm cartoon-btn text-xs flex justify-center items-center">
                        <i class="fa-solid fa-copy mr-1"></i> è¤‡è£½æ–‡å­—
                    </button>
                </div>
            </div>
            <div class="bg-white border-2 border-black rounded-lg p-2 mb-4 text-center">
                <span class="text-sm text-gray-500">ç›®å‰ç¸½è¨ˆ (TWD)</span>
                <div class="text-2xl font-bold text-shin-red" id="total-twd">NT$ 0</div>
            </div>

            <div id="expense-list" class="space-y-3 pb-20">
                <!-- Javascript will populate this -->
            </div>

        </section>

        <!-- SECTION: LISTS (æ¸…å–®) -->
        <section id="lists" class="section-content">
            
            <!-- Checklist -->
            <div class="cartoon-box p-4 mb-6 bg-blue-50">
                <h3 class="font-cute mb-3 text-lg border-b-2 border-black pb-1 inline-block"><i class="fa-solid fa-suitcase mr-2"></i>è¡Œå‰æº–å‚™æ¸…å–®</h3>
                <div id="checklist-container" class="space-y-2">
                    <!-- Javascript populates -->
                </div>
                <div class="mt-3 flex gap-2">
                    <input type="text" id="new-check-item" placeholder="æ–°å¢é …ç›®..." class="flex-1 border-2 border-black rounded px-2 text-sm">
                    <button onclick="addCheckItem()" class="bg-shin-blue text-white border-2 border-black px-3 rounded font-bold text-sm">+</button>
                </div>
            </div>

            <!-- Memo -->
            <div class="cartoon-box p-4 bg-yellow-50">
                <h3 class="font-cute mb-3 text-lg border-b-2 border-black pb-1 inline-block"><i class="fa-solid fa-pen mr-2"></i>å‚™å¿˜éŒ„ (é€£çµè‡ªå‹•è½‰æ›)</h3>
                <textarea id="memo-area" class="w-full h-32 p-2 border-2 border-black rounded mb-2 text-sm" placeholder="è¼¸å…¥æ–‡å­—æˆ–ç¶²å€..."></textarea>
                <div id="memo-display" class="p-2 bg-white border-2 border-black rounded min-h-[50px] text-sm whitespace-pre-wrap break-words"></div>
            </div>

        </section>

        <!-- SECTION: INFO (è³‡è¨Š) -->
        <section id="info" class="section-content">
            <h2 class="text-2xl font-cute text-center mb-6">æ—…éŠå°å¹«æ‰‹</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="cartoon-box p-4 flex flex-col items-center justify-center hover:bg-gray-50">
                    <i class="fa-solid fa-cloud-sun text-4xl text-shin-blue mb-2"></i>
                    <span class="font-bold">å¤©æ°£é å ±</span>
                </a>
                <a href="https://www.google.com/maps/search/drugstore" target="_blank" class="cartoon-box p-4 flex flex-col items-center justify-center hover:bg-gray-50">
                    <i class="fa-solid fa-kit-medical text-4xl text-shin-red mb-2"></i>
                    <span class="font-bold">é™„è¿‘è—¥å¦</span>
                </a>
            </div>

            <div class="cartoon-box p-4 bg-white mb-6">
                <h3 class="font-cute mb-2 text-lg text-red-600"><i class="fa-solid fa-phone-volume mr-2"></i>ç·Šæ€¥è¯çµ¡</h3>
                <ul class="space-y-2 text-sm font-bold">
                    <li>ğŸ‘® è­¦å¯Ÿå±€ï¼š110</li>
                    <li>ğŸš‘ æ•‘è­·è»Š/ç«è­¦ï¼š119</li>
                    <li>ğŸ‡¹ğŸ‡¼ å°åŒ—é§å¤§é˜ªç¶“æ–‡è™•ç¦å²¡åˆ†è™•ï¼š</li>
                    <li class="pl-6 text-blue-600"><a href="tel:+81927342810">+81-92-734-2810</a></li>
                </ul>
            </div>

            <div class="cartoon-box p-4 bg-gray-100">
                <h3 class="font-cute mb-2 text-lg"><i class="fa-solid fa-triangle-exclamation mr-2"></i>æ³¨æ„äº‹é …</h3>
                <ul class="list-disc pl-5 text-sm space-y-1 text-gray-700">
                    <li>æ—¥æœ¬æ’åº§ç‚ºå…©å­”æ‰æ’ (èˆ‡å°ç£åŒ)ï¼Œé›»å£“ 100Vã€‚</li>
                    <li>è‰è“åœ’é€šå¸¸ 16:00 å·¦å³é—œé–€ï¼Œè«‹æ³¨æ„æ™‚é–“ã€‚</li>
                    <li>ç§Ÿè»Šå‹™å¿…æ”œå¸¶ã€Œå°ç£é§•ç…§ã€+ã€Œæ—¥æ–‡è­¯æœ¬ã€ã€‚</li>
                    <li>ç¦å²¡åƒåœ¾æ¡¶è¼ƒå°‘ï¼Œå»ºè­°éš¨èº«æ”œå¸¶å¡‘è† è¢‹è£åƒåœ¾ã€‚</li>
                </ul>
            </div>
        </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 w-full bg-white border-t-4 border-black z-50 pb-safe">
        <div class="flex justify-around items-center py-2 pb-4">
            <button onclick="switchTab('plan')" class="nav-btn active flex flex-col items-center text-gray-400 hover:text-shin-red w-1/5">
                <i class="fa-solid fa-calendar-days text-xl mb-1"></i>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button onclick="switchTab('guide')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-shin-red w-1/5">
                <i class="fa-solid fa-book-open text-xl mb-1"></i>
                <span class="text-[10px] font-bold">å°è¦½</span>
            </button>
            <button onclick="switchTab('wallet')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-shin-red w-1/5 relative">
                <div class="absolute -top-6 bg-shin-yellow border-2 border-black rounded-full p-3 shadow-cartoon-sm transform hover:scale-110 transition">
                    <i class="fa-solid fa-calculator text-2xl text-black"></i>
                </div>
                <span class="text-[10px] font-bold mt-6">è¨˜å¸³</span>
            </button>
            <button onclick="switchTab('lists')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-shin-red w-1/5">
                <i class="fa-solid fa-list-check text-xl mb-1"></i>
                <span class="text-[10px] font-bold">æ¸…å–®</span>
            </button>
            <button onclick="switchTab('info')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-shin-red w-1/5">
                <i class="fa-solid fa-circle-info text-xl mb-1"></i>
                <span class="text-[10px] font-bold">è³‡è¨Š</span>
            </button>
        </div>
    </nav>

    <script>
        // --- Data & Initialization ---
        const itineraryData = [
            {
                day: "Day 1", date: "12/2 (äºŒ)", title: "ç¦å²¡æŠµé”", 
                events: [
                    { time: "11:40", title: "æ¡ƒåœ’å‡ºç™¼", desc: "BR104", type: "transport" },
                    { time: "14:55", title: "æŠµé”ç¦å²¡", desc: "è¾¦ç†å…¥å¢ƒ", type: "transport" },
                    { time: "15:45", title: "é£¯åº— Check-in", desc: "ç¥‡åœ’/åšå¤š", type: "hotel", link: "Daiwa Roynet Hotel Hakata-Reisen" },
                    { time: "17:00", title: "åšå¤šé‹æ²³åŸ", desc: "æ™šé¤ï¼šç‰›è…¸é‹", type: "food", link: "åšå¤šé‹æ²³åŸ" },
                    { time: "19:00", title: "å¯¶å¯å¤¢ä¸­å¿ƒ", desc: "åšå¤šç«™", type: "shopping", link: "Pokemon Center Fukuoka" },
                    { time: "20:30", title: "è–èª•å¸‚é›†", desc: "åšå¤šç«™å‰", type: "sight" }
                ]
            },
            {
                day: "Day 2", date: "12/3 (ä¸‰)", title: "ç¦å²¡å¸‚å€", 
                events: [
                    { time: "10:00", title: "æ«›ç”°ç¥ç¤¾", desc: "åšå¤šç¸½é®å®ˆ", type: "sight", link: "æ«›ç”°ç¥ç¤¾" },
                    { time: "11:00", title: "å¤©ç¥ç™¾è²¨", desc: "å²©ç”°å±‹ / ä¸‰è¶Š", type: "shopping" },
                    { time: "12:00", title: "æ•˜æ•˜è‹‘ (å·²é ç´„)", desc: "åˆé¤ç‡’è‚‰", type: "food", link: "æ•˜æ•˜è‹‘ ç¦å²¡" },
                    { time: "13:30", title: "å¤©ç¥é€›è¡—", desc: "Parco, Bic Camera", type: "shopping" },
                    { time: "18:00", title: "ä¸€è˜­æ‹‰éºµ", desc: "ç¸½åº—æˆ–åˆ†åº—", type: "food", link: "ä¸€è˜­æ‹‰éºµ æœ¬ç¤¾ç¸½æœ¬åº—" },
                    { time: "20:00", title: "ä¸­æ´²å±‹å°", desc: "& å”å‰è¨¶å¾·", type: "sight", link: "ä¸­æ´²å±‹å°" }
                ]
            },
            {
                day: "Day 3", date: "12/4 (å››)", title: "é–€å¸æ¸¯ & å°å€‰", 
                events: [
                    { time: "09:30", title: "æ­ä¹˜éŸ³é€Ÿè™Ÿ", desc: "å‰å¾€å°å€‰/é–€å¸æ¸¯", type: "transport" },
                    { time: "10:30", title: "é–€å¸æ¸¯æ‡·èˆŠå€", desc: "é¦™è•‰äºº, è—ç¿¼æ©‹", type: "sight", link: "é–€å¸æ¸¯" },
                    { time: "12:00", title: "BEAR FRUITS", desc: "åˆé¤ï¼šç‡’å’–å“©", type: "food", link: "BEAR FRUITS é–€å¸æ¸¯" },
                    { time: "14:00", title: "æ—¦éå¸‚å ´", desc: "å‚æ™šæ”¶æ”¤æ—©é»å»", type: "sight", link: "æ—¦éå¸‚å ´" },
                    { time: "15:00", title: "å°å€‰åŸ", desc: "åº­åœ’ / é­šç”ºéŠ€å¤©è¡—", type: "sight", link: "å°å€‰åŸ" },
                    { time: "16:30", title: "å‰å¾€çš¿å€‰å±±", desc: "JRå…«å¹¡ç«™è½‰è¨ˆç¨‹è»Š", type: "sight", link: "çš¿å€‰å±±" },
                    { time: "20:30", title: "å¤§æ±åœ’ ç‡’è‚‰", desc: "æ™šé¤ (æœ¬åº—)", type: "food", link: "å¤§æ±åœ’ æœ¬åº—" }
                ]
            },
            {
                day: "Day 4", date: "12/5 (äº”)", title: "ç§Ÿè»Šå—ä¸‹", 
                events: [
                    { time: "09:00", title: "åšå¤šè»Šç«™ç§Ÿè»Š", desc: "â—é‡è¦ï¼šå¸¶é§•ç…§è­¯æœ¬", type: "transport", highlight: true },
                    { time: "10:00", title: "å¤ªå®°åºœå¤©æ»¿å®®", desc: "è¡¨åƒé“åƒæ¢…æé¤…", type: "sight", link: "å¤ªå®°åºœå¤©æ»¿å®®" },
                    { time: "12:00", title: "Lalaport ç¦å²¡", desc: "åˆé¤ & çœ‹é‹¼å½ˆ", type: "shopping", link: "Lalaport ç¦å²¡" },
                    { time: "16:00", title: "å‰å¾€æµ®ç¾½", desc: "é–‹è»Šç´„ 60 åˆ†é˜", type: "transport" },
                    { time: "19:00", title: "æµ®ç¾½/ä¹…ç•™ç±³", desc: "é£¯åº—ä¼‘æ¯", type: "hotel" }
                ]
            },
            {
                /* SWAPPED: Now this is Aso Volcano */
                day: "Day 5", date: "12/6 (å…­)", title: "é˜¿è˜‡ç«å±±èˆ‡èµ¤ç‰›ä¸¼", 
                events: [
                    { time: "08:30", title: "å‰å¾€é˜¿è˜‡", desc: "æ—©èµ·å‡ºç™¼", type: "transport" },
                    { time: "10:00", title: "å¤§è§€å³°å±•æœ›æ‰€", desc: "çµ•æ™¯", type: "sight", link: "å¤§è§€å³°" },
                    { time: "11:00", title: "é˜¿è˜‡ç¥ç¤¾å€åŸŸ", desc: "åˆé¤ï¼šèµ¤ç‰›ä¸¼", type: "food", link: "é˜¿è˜‡ç¥ç¤¾" },
                    { time: "13:00", title: "è‰åƒé‡Œä¹‹æ¿±", desc: "& ç«å±±åšç‰©é¤¨", type: "sight", link: "è‰åƒé‡Œ" },
                    { time: "15:30", title: "æ¡è‰è“", desc: "Ichigo Kirari (éœ€é ç´„)", type: "sight", highlight: true, link: "Ichigo Kirari" }
                ]
            },
            {
                day: "Day 6", date: "12/7 (æ—¥)", title: "ç”±å¸ƒé™¢æ•£ç­–", 
                events: [
                    { time: "09:30", title: "å‰å¾€ç”±å¸ƒé™¢", desc: "é–‹è»Š", type: "transport" },
                    { time: "11:00", title: "ç”±å¸ƒé™¢é‡œé£¯å¿ƒ", desc: "â—å…ˆç™»è¨˜å€™ä½", type: "food", highlight: true, link: "ç”±å¸ƒé™¢é‡œé£¯å¿ƒ" },
                    { time: "11:30", title: "æ¹¯ä¹‹åª/é‡‘é±—æ¹–", desc: "é€›è¡—æ‹ç…§", type: "sight", link: "é‡‘é±—æ¹–" },
                    { time: "13:00", title: "åˆé¤", desc: "ä¾ç™»è¨˜æ™‚é–“å›è¨ªé‡œé£¯", type: "food" },
                    { time: "14:30", title: "Floral Village", desc: "ç«¥è©±æ‘", type: "sight", link: "Yufuin Floral Village" },
                    { time: "16:00", title: "è¿”å›æµ®ç¾½", desc: "æ™šé¤å±…é…’å±‹", type: "transport" }
                ]
            },
            {
                /* SWAPPED: Now this is Kumamoto */
                day: "Day 7", date: "12/8 (ä¸€)", title: "ç†Šæœ¬ä¸€æ—¥éŠ", 
                events: [
                    { time: "09:30", title: "æµ®ç¾½ç¨»è·ç¥ç¤¾", desc: "åƒæœ¬é³¥å±…", type: "sight", link: "æµ®ç¾½ç¨»è·ç¥ç¤¾" },
                    { time: "10:30", title: "å‰å¾€ç†Šæœ¬", desc: "é–‹è»Šç§»å‹•", type: "transport" },
                    { time: "12:00", title: "å‹çƒˆäº­è±¬æ’", desc: "åˆé¤ (éœ€æ’éšŠ)", type: "food", link: "å‹çƒˆäº­ æ–°å¸‚è¡—æœ¬åº—" },
                    { time: "13:30", title: "ç†Šæœ¬åŸ", desc: "& æ«»ä¹‹é¦¬å ´ åŸå½©è‹‘", type: "sight", link: "ç†Šæœ¬åŸ" },
                    { time: "15:30", title: "é…·MAèŒå»£å ´", desc: "â—éƒ¨é•·è¡¨æ¼” 16:30 (éœ€ç¢ºèª)", type: "sight", highlight: true, link: "Kumamon Square" },
                    { time: "18:30", title: "ç†Šæœ¬æ‹‰éºµ", desc: "é»‘äº­ æˆ– æ¡‚èŠ±", type: "food" }
                ]
            },
            {
                day: "Day 8", date: "12/9 (äºŒ)", title: "æ—©èµ·è¿”å°", 
                events: [
                    { time: "07:30", title: "é£¯åº—å‡ºç™¼", desc: "é¿é–‹ä¸Šç­è»Šæ½®", type: "transport", highlight: true },
                    { time: "09:00", title: "ç¦å²¡æ©Ÿå ´", desc: "é‚„è»Š & Check-in", type: "transport" },
                    { time: "09:30", title: "å…ç¨…åº—è¡åˆº", desc: "æœ€å¾Œè³¼ç‰©", type: "shopping" },
                    { time: "12:40", title: "BR105 èµ·é£›", desc: "Bye Bye Kyushu", type: "transport" }
                ]
            }
        ];

        // --- Render Functions ---

        function renderPlan() {
            const container = document.getElementById('itinerary-list');
            let html = '';
            
            itineraryData.forEach((day, index) => {
                let dayHtml = `
                    <div class="relative pl-6 pb-4 border-l-4 border-gray-300 ml-2">
                        <div class="absolute -left-3 top-0 bg-shin-red text-white w-6 h-6 rounded-full flex items-center justify-center border-2 border-black font-bold text-xs shadow-cartoon-sm">${index + 1}</div>
                        <div class="bg-shin-yellow border-2 border-black px-3 py-1 rounded inline-block font-bold mb-3 shadow-cartoon-sm">
                            ${day.date} ${day.title}
                        </div>
                        <div class="space-y-3">
                `;

                day.events.forEach(event => {
                    const icon = getIconByType(event.type);
                    const highlightClass = event.highlight ? "bg-red-50 border-shin-red" : "bg-white border-black";
                    const mapBtn = event.link ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.link)}" target="_blank" class="text-blue-500 ml-2"><i class="fa-solid fa-map-location-dot"></i></a>` : '';
                    
                    dayHtml += `
                        <div class="p-3 rounded-lg border-2 ${highlightClass} shadow-cartoon-sm flex items-start">
                            <div class="w-12 text-xs font-bold pt-1 text-gray-500">${event.time}</div>
                            <div class="flex-1 pl-2 border-l-2 border-dashed border-gray-300">
                                <div class="font-bold text-sm flex items-center">
                                    <i class="${icon} mr-1 text-gray-600"></i>
                                    ${event.title}
                                    ${mapBtn}
                                </div>
                                <div class="text-xs text-gray-600 mt-1">${event.desc}</div>
                            </div>
                        </div>
                    `;
                });

                dayHtml += `</div></div>`;
                html += dayHtml;
            });
            container.innerHTML = html;
        }

        function getIconByType(type) {
            const map = {
                'transport': 'fa-solid fa-car-side',
                'hotel': 'fa-solid fa-bed',
                'food': 'fa-solid fa-utensils',
                'shopping': 'fa-solid fa-bag-shopping',
                'sight': 'fa-solid fa-camera-retro'
            };
            return map[type] || 'fa-solid fa-circle';
        }

        // --- Wallet Logic ---
        let expenses = JSON.parse(localStorage.getItem('kyushu_expenses')) || [];
        const RATE = 0.2;

        function addToCalc(val) {
            const input = document.getElementById('calc-input');
            input.value += val;
        }

        function clearCalc() {
            document.getElementById('calc-input').value = '';
            document.getElementById('calc-result-twd').innerText = 'NT$ 0';
        }

        function calculate() {
            const input = document.getElementById('calc-input');
            try {
                // Safe eval regex check could be added here, but for simple personal app:
                const result = eval(input.value); 
                input.value = result;
                const twd = Math.round(result * RATE);
                document.getElementById('calc-result-twd').innerText = `NT$ ${twd}`;
            } catch (e) {
                input.value = 'Error';
            }
        }

        // Auto calc on typing
        document.getElementById('calc-input').addEventListener('input', function() {
            try {
                const val = this.value;
                if(val && !val.match(/[+\-*/]$/)) {
                    const res = eval(val);
                    const twd = Math.round(res * RATE);
                    document.getElementById('calc-result-twd').innerText = `NT$ ${twd}`;
                }
            } catch(e) {}
        });

        function previewImage() {
            const file = document.getElementById('expense-img').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('img-preview').src = e.target.result;
                    document.getElementById('img-preview-container').classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        }

        function addExpense() {
            const item = document.getElementById('expense-item').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const fileInput = document.getElementById('expense-img');
            
            if (!item || isNaN(amount)) {
                alert('è«‹è¼¸å…¥é …ç›®å’Œé‡‘é¡');
                return;
            }

            const processSave = (base64Img) => {
                const expense = {
                    id: Date.now(),
                    item,
                    amount,
                    img: base64Img
                };
                expenses.unshift(expense);
                localStorage.setItem('kyushu_expenses', JSON.stringify(expenses));
                renderExpenses();
                
                // Reset form
                document.getElementById('expense-item').value = '';
                document.getElementById('expense-amount').value = '';
                document.getElementById('expense-img').value = '';
                document.getElementById('img-preview-container').classList.add('hidden');
                alert('è¨˜å¸³æˆåŠŸï¼');
            };

            if (fileInput.files && fileInput.files[0]) {
                // Compress Image
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 300;
                        const scaleSize = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        processSave(dataUrl);
                    }
                    img.src = event.target.result;
                }
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                processSave(null);
            }
        }

        function renderExpenses() {
            const list = document.getElementById('expense-list');
            let html = '';
            let totalTwd = 0;

            expenses.forEach(ex => {
                const twd = Math.round(ex.amount * RATE);
                totalTwd += twd;
                const imgHtml = ex.img ? `<img src="${ex.img}" class="w-12 h-12 object-cover rounded border border-black mr-3">` : `<div class="w-12 h-12 bg-gray-200 rounded border border-black mr-3 flex items-center justify-center text-gray-400"><i class="fa-solid fa-receipt"></i></div>`;
                
                html += `
                    <div class="flex items-center bg-white p-2 rounded border-2 border-black shadow-cartoon-sm">
                        ${imgHtml}
                        <div class="flex-1">
                            <div class="font-bold text-sm">${ex.item}</div>
                            <div class="text-xs text-gray-500 text-right">Â¥${ex.amount}</div>
                            <div class="text-sm font-bold text-shin-red text-right">NT$ ${twd}</div>
                        </div>
                        <button onclick="deleteExpense(${ex.id})" class="ml-3 text-gray-400 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
            });

            list.innerHTML = html;
            document.getElementById('total-twd').innerText = `NT$ ${totalTwd}`;
        }

        function deleteExpense(id) {
            if(confirm('ç¢ºå®šåˆªé™¤æ­¤ç­†ç´€éŒ„ï¼Ÿ')) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('kyushu_expenses', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function clearExpenses() {
            if(confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è¨˜å¸³ç´€éŒ„ï¼Ÿ')) {
                expenses = [];
                localStorage.setItem('kyushu_expenses', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function exportCSV() {
            if(expenses.length === 0) {
                alert('ç›®å‰æ²’æœ‰è¨˜å¸³è³‡æ–™');
                return;
            }

            // BOM for UTF-8 in Excel
            let csvContent = "\uFEFF"; 
            csvContent += "æ—¥æœŸ,é …ç›®,æ—¥å¹£é‡‘é¡,ç´„å°å¹£(x0.2)\n";

            expenses.forEach(ex => {
                const date = ex.date ? ex.date : new Date(ex.id).toLocaleDateString();
                const twd = Math.round(ex.amount * RATE);
                // Quote item to handle commas
                const item = `"${ex.item}"`; 
                csvContent += `${date},${item},${ex.amount},${twd}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `ä¹å·è¨˜å¸³_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyToClipboard() {
            if(expenses.length === 0) {
                alert('ç›®å‰æ²’æœ‰è¨˜å¸³è³‡æ–™');
                return;
            }

            let text = "ä¹å·ä¹‹æ—…è¨˜å¸³æ¸…å–®ï¼š\n----------------\n";
            let totalJPY = 0;
            let totalTWD = 0;

            expenses.forEach((ex, index) => {
                const twd = Math.round(ex.amount * RATE);
                totalJPY += ex.amount;
                totalTWD += twd;
                text += `${index+1}. ${ex.item}: Â¥${ex.amount} (ç´„NT$${twd})\n`;
            });

            text += "----------------\n";
            text += `ç¸½è¨ˆ: Â¥${totalJPY} (ç´„NT$${totalTWD})`;

            navigator.clipboard.writeText(text).then(() => {
                alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            }).catch(err => {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•æˆªåœ–ã€‚');
            });
        }

        // --- Checklist & Memo Logic ---
        let checklist = JSON.parse(localStorage.getItem('kyushu_checklist')) || [
            { id: 1, text: 'è­·ç…§ (å…­å€‹æœˆæ•ˆæœŸ)', checked: false },
            { id: 2, text: 'æ—¥æ–‡é§•ç…§è­¯æœ¬ + å°ç£é§•ç…§', checked: false },
            { id: 3, text: 'ç¶²å¡ / Roaming é–‹é€š', checked: false },
            { id: 4, text: 'æ—¥å¹£ç¾é‡‘ / ä¿¡ç”¨å¡', checked: false },
            { id: 5, text: 'è¡Œå‹•é›»æº / å……é›»ç·š', checked: false },
            { id: 6, text: 'å€‹äººè—¥å“ / æšˆè»Šè—¥', checked: false },
            { id: 7, text: 'VJW å…¥å¢ƒ QR Code æˆªåœ–', checked: false }
        ];

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            let html = '';
            checklist.forEach(item => {
                const checkedClass = item.checked ? 'line-through text-gray-400 bg-gray-100' : 'bg-white';
                const checkIcon = item.checked ? 'fa-square-check text-green-500' : 'fa-square text-gray-300';
                
                html += `
                    <div onclick="toggleCheck(${item.id})" class="flex items-center p-2 border-2 border-black rounded cursor-pointer ${checkedClass} transition">
                        <i class="fa-regular ${checkIcon} text-xl mr-3"></i>
                        <span class="font-bold text-sm">${item.text}</span>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function toggleCheck(id) {
            const item = checklist.find(i => i.id === id);
            item.checked = !item.checked;
            localStorage.setItem('kyushu_checklist', JSON.stringify(checklist));
            renderChecklist();
        }

        function addCheckItem() {
            const text = document.getElementById('new-check-item').value;
            if(text) {
                checklist.push({ id: Date.now(), text, checked: false });
                localStorage.setItem('kyushu_checklist', JSON.stringify(checklist));
                document.getElementById('new-check-item').value = '';
                renderChecklist();
            }
        }

        // Memo Logic
        const memoArea = document.getElementById('memo-area');
        const memoDisplay = document.getElementById('memo-display');

        memoArea.value = localStorage.getItem('kyushu_memo') || '';
        updateMemoDisplay();

        memoArea.addEventListener('input', function() {
            localStorage.setItem('kyushu_memo', this.value);
            updateMemoDisplay();
        });

        function updateMemoDisplay() {
            const text = memoArea.value;
            // Regex to find URLs and convert to links
            const linkedText = text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-500 underline break-all"><i class="fa-solid fa-link"></i> é€£çµ</a>');
            memoDisplay.innerHTML = linkedText || '<span class="text-gray-400">é è¦½é€£çµå°‡é¡¯ç¤ºæ–¼æ­¤...</span>';
        }

        // --- Navigation ---
        function switchTab(tabId) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
            });
            // Show target
            document.getElementById(tabId).classList.add('active');
            
            // Update buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-shin-red', 'active');
                btn.classList.add('text-gray-400');
            });
            event.currentTarget.classList.remove('text-gray-400');
            event.currentTarget.classList.add('text-shin-red', 'active');
            
            window.scrollTo(0,0);
        }

        // --- Init ---
        window.onload = function() {
            renderPlan();
            renderExpenses();
            renderChecklist();
        };

    </script>
</body>
</html>
